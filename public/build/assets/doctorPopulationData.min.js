/*!
 * Doctor Population Script
 * https://skubbsdev.github.io
 * Copyright 2024 - Arthur Immanuel 
 * Released under the MIT license
 * For web development contact me @ konnichiwa@arthurimmanuel.com
 * or visit my portfolio @ https://arthurimmanuel.com
 */
$(document).ready(function () {
    var doctorSpecialtyMap = {};

    function populateSpecialtiesDropdown() {
        var $s = $('select.select-dropdown-specialties'),
            $n = $('div.nice-select-specialty ul.list'),
            a = {},
            o = [];

        $('.specialties-list-to-dropdown').each(function () {
            var s = $(this).text().trim();
            if (!a[s]) {
                a[s] = true;
                o.push($('<option>', { value: s, text: s }));
                $n.append($('<li>', { 'data-value': s, 'class': 'option', text: s }));
            }
        });

        $s.append(o);
        $('select.select-dropdown-specialties').niceSelect('update');
    }

    function populateDoctorsDropdown(selectedSpecialty) {
        var $d = $('select.select-dropdown-doctors'),
            $n = $('div.nice-select-doctors ul.list'),
            o = [];

        $d.empty();
        $n.empty();
        $d.append($('<option>', { value: '', text: 'Choose Doctor' }));
        $n.append($('<li>', { 'data-value': '', 'class': 'option', text: 'Choose Doctor' }));

        $('.doctors-list-to-dropdown').each(function () {
            var d = $(this).text().trim(),
                sp = $(this).siblings('.specialties-list-to-dropdown').text().trim();
            doctorSpecialtyMap[d] = sp;

            if (selectedSpecialty === '' || sp === selectedSpecialty) {
                o.push($('<option>', { value: d, text: d }));
                $n.append($('<li>', { 'data-value': d, 'class': 'option', text: d }));
            }
        });

        $d.append(o);
        $('select.select-dropdown-doctors').niceSelect('update');
        var $nd = $('div.nice-select-doctors');
        $nd.find('span.current').text('Choose Doctor');
        $nd.find('.option.selected').removeClass('selected');
        $nd.find('.option[data-value=""]').addClass('selected');
    }

    function showDoctorDetails(selectedDoctor) {
        $('.w-dyn-item').each(function () {
            var $t = $(this),
                n = $t.find('.doctors-list-to-dropdown').text().trim();

            if (n === selectedDoctor) {
                $t.removeClass('d-none');
            } else {
                $t.addClass('d-none');
            }
        });
    }

    function selectSpecialtyBasedOnDoctor(doctor) {
        var specialty = doctorSpecialtyMap[doctor] || '';
        $('#Specialty').val(specialty).niceSelect('update');
    }

    $('select').niceSelect();

    populateSpecialtiesDropdown();
    populateDoctorsDropdown('');

    $('#Specialty').on('change', function () {
        var s = $(this).val();
        populateDoctorsDropdown(s);
        $('#Doctor').val('').niceSelect('update');
        showDoctorDetails('');
    });

    $('#Doctor').on('change', function () {
        var selectedDoctor = $(this).val();
        showDoctorDetails(selectedDoctor);
        selectSpecialtyBasedOnDoctor(selectedDoctor);
    });
});
